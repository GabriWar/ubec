[
  {
    "id": "main_flow",
    "type": "tab",
    "label": "ğŸŒ UBEC Solar Plant - Clean (No Dashboard)",
    "disabled": false,
    "info": "Complete monitoring system without dashboard UI\n\nAll data logged to terminal with full payload details"
  },
  {
    "id": "comment_header",
    "type": "comment",
    "z": "main_flow",
    "name": "ğŸ›ï¸ UBEC SOLAR PLANT - TERMINAL OUTPUT ONLY",
    "info": "Complete monitoring with terminal logging",
    "x": 320,
    "y": 40,
    "wires": []
  },
  {
    "id": "comment_section1",
    "type": "comment",
    "z": "main_flow",
    "name": "â° SCHEDULERS & TRIGGERS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
    "info": "Automatic and manual triggers",
    "x": 320,
    "y": 100,
    "wires": []
  },
  {
    "id": "init_startup",
    "type": "inject",
    "z": "main_flow",
    "name": "ğŸš€ Initialize",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": true,
    "onceDelay": 0.1,
    "topic": "",
    "x": 150,
    "y": 140,
    "wires": [["init_system"]]
  },
  {
    "id": "init_system",
    "type": "function",
    "z": "main_flow",
    "name": "ğŸ”§ Initialize System",
    "func": "node.status({fill:\"blue\",shape:\"ring\",text:\"Initializing...\"});\n\nconsole.log('\\n' + '='.repeat(60));\nconsole.log('ğŸš€ UBEC SOLAR PLANT MONITORING SYSTEM');\nconsole.log('='.repeat(60));\nconsole.log('â° Startup Time:', new Date().toISOString());\nconsole.log('ğŸ”§ Initializing global variables...');\n\nglobal.set('is_collecting', false);\nglobal.set('clp_data', {});\nglobal.set('system_status', 'online');\nglobal.set('error_count', 0);\nglobal.set('success_count', 0);\nglobal.set('last_collection_time', null);\nglobal.set('start_time', Date.now());\n\nconsole.log('âœ… System initialized successfully!');\nconsole.log('ğŸ“¡ Modbus: 192.168.10.1:502');\nconsole.log('ğŸ”„ Interval: 30 seconds');\nconsole.log('='.repeat(60) + '\\n');\n\nnode.status({fill:\"green\",shape:\"dot\",text:\"System Ready\"});\n\nreturn {payload: {status: 'online', timestamp: new Date().toISOString()}};",
    "outputs": 1,
    "noerr": 0,
    "x": 320,
    "y": 140,
    "wires": [["debug_init"]]
  },
  {
    "id": "debug_init",
    "type": "debug",
    "z": "main_flow",
    "name": "ğŸ” Init",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 510,
    "y": 140,
    "wires": []
  },
  {
    "id": "inject_auto",
    "type": "inject",
    "z": "main_flow",
    "name": "â° Auto (30s)",
    "props": [],
    "repeat": "30",
    "crontab": "",
    "once": true,
    "onceDelay": "3",
    "topic": "",
    "x": 150,
    "y": 200,
    "wires": [["start_collection"]]
  },
  {
    "id": "inject_manual",
    "type": "inject",
    "z": "main_flow",
    "name": "ğŸ‘† Manual",
    "props": [],
    "repeat": "",
    "crontab": "",
    "once": false,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 140,
    "y": 260,
    "wires": [["start_collection"]]
  },
  {
    "id": "comment_section2",
    "type": "comment",
    "z": "main_flow",
    "name": "ğŸ¯ DATA COLLECTION â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
    "info": "Modbus data collection",
    "x": 290,
    "y": 320,
    "wires": []
  },
  {
    "id": "start_collection",
    "type": "function",
    "z": "main_flow",
    "name": "ğŸ¬ Start Collection",
    "func": "const isCollecting = global.get('is_collecting');\n\nif (isCollecting) {\n    node.status({fill:\"yellow\",shape:\"ring\",text:\"In progress...\"});\n    console.log('âš ï¸  Collection in progress - skipping');\n    return null;\n}\n\nglobal.set('is_collecting', true);\nglobal.set('clp_data', {});\nconst timestamp = new Date().toISOString();\nglobal.set('clp_timestamp', timestamp);\n\nnode.status({fill:\"blue\",shape:\"dot\",text:\"Collecting...\"});\n\nconsole.log('\\nâ”'.repeat(40));\nconsole.log('ğŸ¬ NEW COLLECTION CYCLE');\nconsole.log('â°', timestamp);\n\nsetTimeout(() => {\n    if (global.get('is_collecting')) {\n        console.log('â±ï¸  Timeout - resetting');\n        global.set('is_collecting', false);\n    }\n}, 15000);\n\nreturn [\n    {payload: {fc: 3, unitid: 1, address: 36, quantity: 7}, topic: 'temperatures'},\n    {payload: {fc: 3, unitid: 1, address: 600, quantity: 10}, topic: 'outputs'},\n    {payload: {fc: 3, unitid: 1, address: 500, quantity: 14}, topic: 'inputs'}\n];",
    "outputs": 3,
    "noerr": 0,
    "x": 320,
    "y": 380,
    "wires": [["modbus_temps"], ["modbus_outputs"], ["modbus_inputs"]]
  },
  {
    "id": "modbus_temps",
    "type": "modbus-flex-getter",
    "z": "main_flow",
    "name": "ğŸŒ¡ï¸ Read Temps",
    "showStatusActivities": false,
    "showErrors": true,
    "server": "modbus_client",
    "useIOFile": false,
    "x": 310,
    "y": 460,
    "wires": [["process_temps"], ["error_handler"]]
  },
  {
    "id": "modbus_outputs",
    "type": "modbus-flex-getter",
    "z": "main_flow",
    "name": "ğŸ”´ Read Outputs",
    "showStatusActivities": false,
    "showErrors": true,
    "server": "modbus_client",
    "useIOFile": false,
    "x": 310,
    "y": 500,
    "wires": [["process_outputs"], ["error_handler"]]
  },
  {
    "id": "modbus_inputs",
    "type": "modbus-flex-getter",
    "z": "main_flow",
    "name": "ğŸ”µ Read Inputs",
    "showStatusActivities": false,
    "showErrors": true,
    "server": "modbus_client",
    "useIOFile": false,
    "x": 310,
    "y": 540,
    "wires": [["process_inputs"], ["error_handler"]]
  },
  {
    "id": "comment_section3",
    "type": "comment",
    "z": "main_flow",
    "name": "âš™ï¸ DATA PROCESSING â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
    "info": "Process collected data",
    "x": 300,
    "y": 600,
    "wires": []
  },
  {
    "id": "process_temps",
    "type": "function",
    "z": "main_flow",
    "name": "ğŸŒ¡ï¸ Process Temps",
    "func": "let registers = [];\n\nif (Array.isArray(msg.values)) {\n    registers = msg.values;\n} else if (msg.payload.buffer && Buffer.isBuffer(msg.payload.buffer)) {\n    const buffer = msg.payload.buffer;\n    for (let i = 0; i < buffer.length; i += 2) {\n        registers.push(buffer.readInt16BE(i));\n    }\n} else if (Array.isArray(msg.payload.data)) {\n    registers = msg.payload.data;\n} else if (Array.isArray(msg.payload)) {\n    registers = msg.payload;\n} else {\n    node.status({fill:\"red\",shape:\"ring\",text:\"Invalid data\"});\n    return null;\n}\n\nconst toSigned16 = (val) => (val > 32767 ? val - 65536 : val);\n\nconst temps = {\n    ambiente: toSigned16(registers[0]) / 10,\n    quadro: toSigned16(registers[2]) / 10,\n    modulo: toSigned16(registers[4]) / 10,\n    trafo: toSigned16(registers[6]) / 10\n};\n\nconsole.log('ğŸŒ¡ï¸  Temps:', temps.ambiente.toFixed(1) + 'Â°C /', temps.quadro.toFixed(1) + 'Â°C /', temps.modulo.toFixed(1) + 'Â°C /', temps.trafo.toFixed(1) + 'Â°C');\n\nnode.status({fill:\"green\",shape:\"dot\",text:`${temps.ambiente.toFixed(1)}Â°C / ${temps.quadro.toFixed(1)}Â°C / ${temps.modulo.toFixed(1)}Â°C / ${temps.trafo.toFixed(1)}Â°C`});\n\nlet data = global.get('clp_data') || {};\ndata.temperaturas = temps;\nglobal.set('clp_data', data);\n\nif (data.temperaturas && data.saidas && data.entradas) {\n    return [msg, {payload: 'aggregate'}];\n}\n\nreturn [msg, null];",
    "outputs": 2,
    "noerr": 0,
    "x": 520,
    "y": 460,
    "wires": [["debug_temps"], ["aggregate_data"]]
  },
  {
    "id": "debug_temps",
    "type": "debug",
    "z": "main_flow",
    "name": "ğŸ” Temps",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 710,
    "y": 440,
    "wires": []
  },
  {
    "id": "process_outputs",
    "type": "function",
    "z": "main_flow",
    "name": "ğŸ”´ Process Outputs",
    "func": "let registers = [];\n\nif (Array.isArray(msg.values)) {\n    registers = msg.values;\n} else if (msg.payload.buffer && Buffer.isBuffer(msg.payload.buffer)) {\n    const buffer = msg.payload.buffer;\n    for (let i = 0; i < buffer.length; i += 2) {\n        registers.push(buffer.readUInt16BE(i));\n    }\n} else if (Array.isArray(msg.payload.data)) {\n    registers = msg.payload.data;\n} else if (Array.isArray(msg.payload)) {\n    registers = msg.payload;\n} else {\n    node.status({fill:\"red\",shape:\"ring\",text:\"Invalid data\"});\n    return null;\n}\n\nconst saidas = {\n    comunicacao_ok: (registers[0] > 0) || false,\n    usina_gerando: (registers[1] > 0) || false,\n    falha: (registers[2] > 0) || false,\n    alarme: (registers[3] > 0) || false,\n    emergencia_inversores: (registers[4] == 0) || false,\n    reset_rasp: (registers[5] > 0) || false,\n    reset_link_3g: (registers[6] > 0) || false,\n    reserva_1: (registers[7] > 0) || false,\n    reserva_2: (registers[8] > 0) || false,\n    reserva_3: (registers[9] > 0) || false\n};\n\nconst activeCount = Object.values(saidas).filter(v => v === true).length;\nconst activeNames = Object.entries(saidas).filter(([k,v]) => v).map(([k]) => k);\n\nconsole.log('ğŸ”´ Outputs:', activeCount + '/10 active' + (activeCount > 0 ? ' (' + activeNames.join(', ') + ')' : ''));\n\nnode.status({fill:activeCount > 0 ? \"green\" : \"grey\",shape:\"dot\",text:`${activeCount}/10`});\n\nlet data = global.get('clp_data') || {};\ndata.saidas = saidas;\nglobal.set('clp_data', data);\n\nif (data.temperaturas && data.saidas && data.entradas) {\n    return [msg, {payload: 'aggregate'}];\n}\n\nreturn [msg, null];",
    "outputs": 2,
    "noerr": 0,
    "x": 520,
    "y": 500,
    "wires": [["debug_outputs"], ["aggregate_data"]]
  },
  {
    "id": "debug_outputs",
    "type": "debug",
    "z": "main_flow",
    "name": "ğŸ” Outputs",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 720,
    "y": 480,
    "wires": []
  },
  {
    "id": "process_inputs",
    "type": "function",
    "z": "main_flow",
    "name": "ğŸ”µ Process Inputs",
    "func": "let registers = [];\n\nif (Array.isArray(msg.values)) {\n    registers = msg.values;\n} else if (msg.payload.buffer && Buffer.isBuffer(msg.payload.buffer)) {\n    const buffer = msg.payload.buffer;\n    for (let i = 0; i < buffer.length; i += 2) {\n        registers.push(buffer.readUInt16BE(i));\n    }\n} else if (Array.isArray(msg.payload.data)) {\n    registers = msg.payload.data;\n} else if (Array.isArray(msg.payload)) {\n    registers = msg.payload;\n} else {\n    node.status({fill:\"red\",shape:\"ring\",text:\"Invalid data\"});\n    return null;\n}\n\nconst entradas = {\n    dj_geral_aberto: (registers[0] > 0) || false,\n    dj_geral_fechado: (registers[1] > 0) || false,\n    reserva_i02: (registers[2] > 0) || false,\n    reserva_i03: (registers[3] > 0) || false,\n    reserva_i04: (registers[4] > 0) || false,\n    reserva_i05: (registers[5] > 0) || false,\n    reserva_i06: (registers[6] > 0) || false,\n    reserva_i07: (registers[7] > 0) || false,\n    reserva_i08: (registers[8] > 0) || false,\n    reserva_i09: (registers[9] > 0) || false,\n    servico_auxiliar: (registers[10] > 0) || false,\n    botao_close: (registers[11] > 0) || false,\n    botao_trip: (registers[12] > 0) || false,\n    botao_emergencia: (registers[13] > 0) || false\n};\n\nconst activeCount = Object.values(entradas).filter(v => v === true).length;\nconst activeNames = Object.entries(entradas).filter(([k,v]) => v).map(([k]) => k);\n\nconsole.log('ğŸ”µ Inputs:', activeCount + '/14 active' + (activeCount > 0 ? ' (' + activeNames.join(', ') + ')' : ''));\n\nnode.status({fill:activeCount > 0 ? \"cyan\" : \"grey\",shape:\"dot\",text:`${activeCount}/14`});\n\nlet data = global.get('clp_data') || {};\ndata.entradas = entradas;\nglobal.set('clp_data', data);\n\nif (data.temperaturas && data.saidas && data.entradas) {\n    return [msg, {payload: 'aggregate'}];\n}\n\nreturn [msg, null];",
    "outputs": 2,
    "noerr": 0,
    "x": 520,
    "y": 540,
    "wires": [["debug_inputs"], ["aggregate_data"]]
  },
  {
    "id": "debug_inputs",
    "type": "debug",
    "z": "main_flow",
    "name": "ğŸ” Inputs",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 710,
    "y": 520,
    "wires": []
  },
  {
    "id": "comment_section4",
    "type": "comment",
    "z": "main_flow",
    "name": "ğŸ“¦ AGGREGATION & OUTPUT â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
    "info": "Aggregate and output data",
    "x": 310,
    "y": 600,
    "wires": []
  },
  {
    "id": "aggregate_data",
    "type": "function",
    "z": "main_flow",
    "name": "ğŸ“¦ Aggregate Data",
    "func": "const data = global.get('clp_data');\nconst timestamp = global.get('clp_timestamp');\n\nif (!data || !data.temperaturas || !data.saidas || !data.entradas) {\n    return null;\n}\n\nconsole.log('ğŸ“¦ Data aggregated successfully!');\n\nconst apiPayload = {\n    device_id: \"CLP_SCHNEIDER_TM200CE24R\",\n    timestamp: timestamp,\n    location: {site: \"Usina Solar UBEC\", installation: \"UBEC AutomaÃ§Ã£o\"},\n    sensors: {\n        temperaturas: {\n            ambiente: {value: data.temperaturas.ambiente, unit: \"celsius\"},\n            quadro_eletrico: {value: data.temperaturas.quadro, unit: \"celsius\"},\n            modulo_fotovoltaico: {value: data.temperaturas.modulo, unit: \"celsius\"},\n            transformador: {value: data.temperaturas.trafo, unit: \"celsius\"}\n        }\n    },\n    status: {\n        outputs: data.saidas,\n        inputs: data.entradas\n    },\n    alerts: []\n};\n\nif (data.saidas.falha) apiPayload.alerts.push({type: \"FAULT\", severity: \"high\"});\nif (data.saidas.alarme) apiPayload.alerts.push({type: \"ALARM\", severity: \"medium\"});\nif (data.temperaturas.trafo > 80) apiPayload.alerts.push({type: \"TEMP_HIGH\", severity: \"high\"});\nif (data.temperaturas.modulo > 70) apiPayload.alerts.push({type: \"TEMP_HIGH\", severity: \"medium\"});\nif (data.saidas.emergencia_inversores) apiPayload.alerts.push({type: \"EMERGENCY\", severity: \"critical\"});\nif (data.entradas.botao_emergencia) apiPayload.alerts.push({type: \"EMERGENCY_BUTTON\", severity: \"critical\"});\n\nlet successCount = global.get('success_count') || 0;\nglobal.set('success_count', successCount + 1);\nglobal.set('is_collecting', false);\nglobal.set('clp_data', {});\n\nnode.status({fill:\"green\",shape:\"dot\",text:`#${successCount + 1}`});\n\nreturn {payload: apiPayload};",
    "outputs": 1,
    "noerr": 0,
    "x": 330,
    "y": 660,
    "wires": [["console_logger", "backup_file", "debug_aggregate"]]
  },
  {
    "id": "console_logger",
    "type": "function",
    "z": "main_flow",
    "name": "ğŸ“‹ Console Logger - FULL PAYLOAD",
    "func": "// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ“‹ LOGGER DE PAYLOAD COMPLETA PARA INTEGRAÃ‡ÃƒO BACKEND\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst payload = msg.payload;\n\nconsole.log('\\n\\n');\nconsole.log('â•”' + 'â•'.repeat(78) + 'â•—');\nconsole.log('â•‘' + ' '.repeat(20) + 'ğŸ“‹ PAYLOAD COMPLETA PARA BACKEND' + ' '.repeat(26) + 'â•‘');\nconsole.log('â•š' + 'â•'.repeat(78) + 'â•');\nconsole.log('');\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// PAYLOAD JSON COMPLETA\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nconsole.log('â”Œâ”€ ğŸ“¦ PAYLOAD JSON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”');\nconsole.log('â”‚');\n\nconst jsonString = JSON.stringify(payload, null, 2);\nconst jsonLines = jsonString.split('\\n');\n\njsonLines.forEach(line => {\n    console.log('â”‚  ' + line);\n});\n\nconsole.log('â”‚');\nconsole.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜');\nconsole.log('');\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// VALORES RESUMIDOS\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nconsole.log('â”Œâ”€ ğŸ“ˆ RESUMO DOS VALORES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”');\nconsole.log('â”‚');\nconsole.log('â”‚  ğŸŒ¡ï¸  TEMPERATURAS:');\n\nif (payload.sensors && payload.sensors.temperaturas) {\n    const temps = payload.sensors.temperaturas;\n    console.log('â”‚     â”œâ”€ Ambiente: ' + temps.ambiente.value.toFixed(1) + 'Â°C');\n    console.log('â”‚     â”œâ”€ Quadro ElÃ©trico: ' + temps.quadro_eletrico.value.toFixed(1) + 'Â°C');\n    console.log('â”‚     â”œâ”€ MÃ³dulo FV: ' + temps.modulo_fotovoltaico.value.toFixed(1) + 'Â°C');\n    console.log('â”‚     â””â”€ Transformador: ' + temps.transformador.value.toFixed(1) + 'Â°C');\n}\n\nconsole.log('â”‚');\nconsole.log('â”‚  ğŸ”´ OUTPUTS ATIVOS: ' + Object.values(payload.status.outputs).filter(v => v).length + '/10');\n\nconst activeOutputs = Object.entries(payload.status.outputs).filter(([k,v]) => v === true);\nif (activeOutputs.length > 0) {\n    activeOutputs.forEach(([key]) => {\n        console.log('â”‚     âœ“ ' + key);\n    });\n}\n\nconsole.log('â”‚');\nconsole.log('â”‚  ğŸ”µ INPUTS ATIVOS: ' + Object.values(payload.status.inputs).filter(v => v).length + '/14');\n\nconst activeInputs = Object.entries(payload.status.inputs).filter(([k,v]) => v === true);\nif (activeInputs.length > 0) {\n    activeInputs.forEach(([key]) => {\n        console.log('â”‚     âœ“ ' + key);\n    });\n}\n\nconsole.log('â”‚');\nconsole.log('â”‚  ğŸš¨ ALERTAS: ' + payload.alerts.length);\n\nif (payload.alerts.length > 0) {\n    payload.alerts.forEach(alert => {\n        const emoji = alert.severity === 'critical' ? 'ğŸ”´' : (alert.severity === 'high' ? 'âš ï¸' : 'ğŸŸ¡');\n        console.log('â”‚     ' + emoji + ' [' + alert.severity.toUpperCase() + '] ' + alert.type);\n    });\n}\n\nconsole.log('â”‚');\nconsole.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜');\nconsole.log('');\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// EXEMPLO CURL\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nconsole.log('â”Œâ”€ ğŸ§ª CURL PARA TESTAR NO BACKEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”');\nconsole.log('â”‚');\nconsole.log('â”‚  curl -X POST http://localhost:3001/api/clp/telemetry \\\\');\nconsole.log('â”‚    -H \"Content-Type: application/json\" \\\\');\nconsole.log('â”‚    -H \"X-Device-ID: ' + payload.device_id + '\" \\\\');\nconsole.log('â”‚    -H \"X-Timestamp: ' + payload.timestamp + '\" \\\\');\nconsole.log('â”‚    -d \\'' + JSON.stringify(payload) + '\\'');\nconsole.log('â”‚');\nconsole.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜');\nconsole.log('');\n\nconsole.log('â•”' + 'â•'.repeat(78) + 'â•—');\nconsole.log('â•‘' + ' '.repeat(30) + 'âœ… LOG COMPLETO' + ' '.repeat(33) + 'â•‘');\nconsole.log('â•š' + 'â•'.repeat(78) + 'â•');\nconsole.log('\\n\\n');\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 600,
    "y": 660,
    "wires": [[]]
  },
  {
    "id": "backup_file",
    "type": "file",
    "z": "main_flow",
    "name": "ğŸ’¾ Backup",
    "filename": "/home/gabriel/clp_data_backup.jsonl",
    "filenameType": "str",
    "appendNewline": true,
    "createDir": true,
    "overwriteFile": "false",
    "encoding": "utf8",
    "x": 550,
    "y": 700,
    "wires": [[]]
  },
  {
    "id": "debug_aggregate",
    "type": "debug",
    "z": "main_flow",
    "name": "ğŸ” Aggregated",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 570,
    "y": 620,
    "wires": []
  },
  {
    "id": "comment_section5",
    "type": "comment",
    "z": "main_flow",
    "name": "ğŸš¨ ERROR HANDLING â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
    "info": "Error handler",
    "x": 280,
    "y": 760,
    "wires": []
  },
  {
    "id": "error_handler",
    "type": "function",
    "z": "main_flow",
    "name": "ğŸš¨ Error Handler",
    "func": "const hasError = msg.error || (msg.payload && msg.payload.error);\nconst hasData = msg.payload && (msg.payload.data || msg.payload.buffer || msg.values);\n\nif (hasData) {\n    return null;\n}\n\nif (hasError) {\n    console.log('âŒ Modbus Error:', msg.topic);\n    let errorCount = global.get('error_count') || 0;\n    global.set('error_count', errorCount + 1);\n    node.status({fill:\"red\",shape:\"ring\",text:`Error #${errorCount + 1}`});\n}\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 310,
    "y": 820,
    "wires": [["debug_errors"]]
  },
  {
    "id": "debug_errors",
    "type": "debug",
    "z": "main_flow",
    "name": "ğŸ” Errors",
    "active": true,
    "tosidebar": true,
    "console": true,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 510,
    "y": 820,
    "wires": []
  },
  {
    "id": "comment_section6",
    "type": "comment",
    "z": "main_flow",
    "name": "ğŸ“Š STATISTICS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
    "info": "System statistics",
    "x": 270,
    "y": 880,
    "wires": []
  },
  {
    "id": "inject_stats",
    "type": "inject",
    "z": "main_flow",
    "name": "ğŸ“Š Stats (5min)",
    "props": [],
    "repeat": "300",
    "crontab": "",
    "once": true,
    "onceDelay": "10",
    "topic": "",
    "x": 160,
    "y": 940,
    "wires": [["generate_stats"]]
  },
  {
    "id": "generate_stats",
    "type": "function",
    "z": "main_flow",
    "name": "ğŸ“ˆ Stats",
    "func": "const successCount = global.get('success_count') || 0;\nconst errorCount = global.get('error_count') || 0;\nconst startTime = global.get('start_time') || Date.now();\nconst uptimeSeconds = Math.floor((Date.now() - startTime) / 1000);\nconst total = successCount + errorCount;\nconst successRate = total > 0 ? ((successCount / total) * 100).toFixed(1) : 100;\n\nconsole.log('\\n' + 'â”'.repeat(40));\nconsole.log('ğŸ“ˆ SYSTEM STATISTICS');\nconsole.log('â”£'.repeat(40));\nconsole.log('â° Time:', new Date().toISOString());\nconsole.log('ğŸ”„ Uptime:', uptimeSeconds, 'seconds');\nconsole.log('ğŸ“Š Collections:');\nconsole.log('   âœ… Successful:', successCount);\nconsole.log('   âŒ Failed:', errorCount);\nconsole.log('   ğŸ“ˆ Success Rate:', successRate + '%');\nconsole.log('â”—'.repeat(40) + '\\n');\n\nnode.status({fill:\"blue\",shape:\"dot\",text:`${successCount} ok, ${successRate}%`});\n\nreturn {payload: {successCount, errorCount, successRate: parseFloat(successRate), uptime: uptimeSeconds}};",
    "outputs": 1,
    "noerr": 0,
    "x": 330,
    "y": 940,
    "wires": [["debug_stats"]]
  },
  {
    "id": "debug_stats",
    "type": "debug",
    "z": "main_flow",
    "name": "ğŸ” Stats",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "x": 510,
    "y": 940,
    "wires": []
  },
  {
    "id": "modbus_client",
    "type": "modbus-client",
    "name": "ğŸ”Œ CLP Schneider",
    "clienttype": "tcp",
    "bufferCommands": true,
    "stateLogEnabled": false,
    "queueLogEnabled": false,
    "tcpHost": "192.168.10.1",
    "tcpPort": "502",
    "tcpType": "DEFAULT",
    "serialPort": "/dev/ttyUSB0",
    "serialType": "RTU-BUFFERD",
    "serialBaudrate": "9600",
    "serialDatabits": "8",
    "serialStopbits": "1",
    "serialParity": "none",
    "serialConnectionDelay": "100",
    "unit_id": "1",
    "commandDelay": "50",
    "clientTimeout": "3000",
    "reconnectOnTimeout": true,
    "reconnectTimeout": "5000",
    "parallelUnitIdsAllowed": true
  }
]

